---
title: 微服务
date: 2024-05-08
---

## Mp

## Docker

快速构建, 运行, 管理应用的工具; 

对于单体项目, 部署方式也就是打包,部署,运行linux命令启动. 

但是现在对于微服务而言, 每个业务都是独立可打包部署的, 传统部署方式太麻烦了

### docker安装

>uname -r #通过 uname -r 命令查看你当前的内核版本
>
>Docker要求CentOS系统的内核版本高于3.10

1. 卸载旧版

   ```
    sudo yum remove docker \
                     docker-client \
                     docker-client-latest \
                     docker-common \
                     docker-latest \
                     docker-latest-logrotate \
                     docker-logrotate \
                     docker-engine
   ```

2. 配置docker的yum库

   安装yum工具

   ```bash
   sudo yum install -y yum-utils
   ```

   映射仓库地址

   ```
   ## 建立Docker仓库 (映射仓库地址)
   sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
   ```

3. 安装docker

   ```
   sudo yum install docker-ce docker-ce-cli containerd.io
   ```

4. 启动和校验

   启动docker

   ```
   sudo systemctl start docker
   //停止docker
   sudo systemctl stop docker
   //重启
   sudo systemctl restart docker
   //设置开机自启
   sudo systemctl enable docker
   //执行docker ps命令， 不报错说明安装启动成功
   docker ps
   ```

    测试是否安装正常

    ```
    sudo docker run hello-world
    ```

5. 配置镜像加速

   注册阿里云账号

   开通镜像服务

   配置镜像加速
   
   ```
   1. 安装／升级Docker客户端
   推荐安装1.10.0以上版本的Docker客户端，参考文档docker-ce
   
   2. 配置镜像加速器
   针对Docker客户端版本大于 1.10.0 的用户
   
   您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器
   
   sudo mkdir -p /etc/docker
   sudo tee /etc/docker/daemon.json <<-'EOF'
   {
     "registry-mirrors": ["https://gnsr8ejh.mirror.aliyuncs.com"]
   }
   EOF
   sudo systemctl daemon-reload
   sudo systemctl restart docker
   ```
   
   

### docker基础

为什么docker部署mysql, 在下载东西, 然后就可以跑起来了? 

- 和传统安装软件一样, 你先下载安装包然后安装, 最后生成了一堆磁盘文件, 就可以跑起来; 如果我直接把最后的磁盘文件全部下载好(绿色免安装版), 不就可以直接运行了
- 其次, 关于配置文件的问题, 如果我下载好后, 做了配置; 然后我换了机器, 我只需要把(磁盘文件+配置文件)(镜像)全部给你, 这样你也可以跑起来, 这个例子就简要说明了docker的基本原理

docker安装应用的时候, 会自动搜索镜像并使用`镜像`. 镜像=应用+运行环境+配置+系统函数库...; 当你运行镜像的时候会创建一个隔离的环境(联想VMware运行多个虚拟的系统!),称为`容器`

`镜像仓库`: 存储和管理镜像的平台, Docker官方维护了一个公共仓库: Docker Hub

`镜像`: 镜像名字是唯一的, 如果本地运行时没有这个镜像, 就回去镜像仓库寻找并下载

`容器`: 有独立的文件, 网络系统...来运行镜像; 容器只有必备的资源确保镜像运行

![image-20240509204856328](./微服务笔记/image-20240509204856328.png)![image-20240509210430764](./微服务笔记/image-20240509210430764.png)

#### 常见命令

![image-20240509211420366](./微服务笔记/image-20240509211420366.png)

从镜像仓库拉去镜像 docker pull

查看本地镜像 docker images

删除镜像 docker rmi

自定义镜像 docker build

序列化镜像 docker save

反序列化镜像 docker load

推送镜像至镜像仓库(可以是官方的镜像仓库/私服仓库) docker push

运行镜像 docker run  -d -name "" -p "":"" -v "":"" image  #注意这步是给镜像生成容器并运行

停止运行镜像 docker stop

启动已停止的镜像 docker start  #容器还在, 只不过是停止了

查看运行中/已停止的容器 docker ps

删除容器 docker rm

查看容器日志 docker logs

执行命令至容器内部 docker exec [-it nginx bash]

命令帮助提示符 --help

![image-20240509211504035](./微服务笔记/image-20240509211504035.png)

查看容器命令的优化

```
vi ~/.bashrc
docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Ports}}\t{{.Status}} \t{{.Names}}"
source ~/.bashrc
```



#### 数据卷

案例引入

![image-20240509214246425](./微服务笔记/image-20240509214246425.png)

1. 先去找到html目录(容器内目录), 官方镜像的文档
2. docker run -v 数据卷:容器内目录
3. 



什么是数据卷

![image-20240509214923621](./微服务笔记/image-20240509214923621.png)

- 是虚拟的目录, 逻辑目录
- linux版docker是在`/var/lib/docker/volumes`下
- 一旦创建了这个映射关系, docker会把容器内目录和宿主机目录进行双向数据绑定!

怎么使用数据卷

![image-20240509215222819](./微服务笔记/image-20240509215222819.png)

怎么去挂载数据卷到容器上

- 在执行docker run命令时, 使用-v 数据卷:容器内目录 就可以完成数据卷挂载
- 当创建容器时, 如果挂载数据卷且数据卷不存在, 则会自动创建数据卷

#### 自定义镜像

#### 日期网络

### 项目部署

#### 部署前端

#### 部署java

#### Docker-Compose

