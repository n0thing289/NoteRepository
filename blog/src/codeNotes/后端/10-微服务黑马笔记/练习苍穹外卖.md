---
title: 拆分苍穹外卖为微服务
date: 2024-05-22
---

## 关于springboot自动装配

>[Spring Boot自动装配原理(易懂)_springboot自动装配原理-CSDN博客](https://blog.csdn.net/qq_41805567/article/details/129111183)
>
>[Spring定义Bean类（四） 自动装配 spring.factories_自定义的bean放在 spring.factories-CSDN博客](https://blog.csdn.net/w13485673086/article/details/104042982)

今天拆分苍穹外卖为微服务的过程中, 尝试启动user-service, 但是告诉我redisUtils的bean不存在, 我立马反应出RedisUtils类在sky-common com.sky.utils包下, 而user-service的启动类在com.sky.user包下. 启动类的自动装配扫描扫描不到上一级包的东西, 也就无法完成自动装配(创建bean到user-service的ioc容器里)

怎么办呢?

一是可以通过@ComponentScan(value="com.sky.utils")解决, 但是user-service的启动类已经有@SpringBootApplication(其中注解又包含了@ComponentScan)了, 如果强行使用, 反而需要从@SpringBootApplication注解中拆分出三个

二是告诉启动类我在哪里, 由于启动类@SpringBootApplication启动时会扫描==所有包==下的`META-INF/spring.factories`文件, 哪个类需要自动配置注入到容器中使用, 配置好类即可

- 所有你需要在resources目录下新建`META-INF/spring.factories`文件

- 配置好需要自动装配的类

  ```
  org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
    com.sky.utils.RedisUtil, \
    com.sky.config.RedisConfig
  ```





非常奇怪, 之前的苍穹外卖也是2.7.3版本我是直接拷贝过来的但是报这样的错`Cannot invoke "org.springframework.web.servlet.mvc.condition.PatternsRequestCondition.getPatterns()" because "this.condition" is null`

>[java - Spring Boot整合Swagger报错："this.condition" is null - 个人文章 - SegmentFault 思否](https://segmentfault.com/a/1190000041908876)

解决方法是: Path匹配策略切换回ant_path_matcher

```properties
spring.mvc.pathmatch.matching-strategy=ant_path_matcher
```

